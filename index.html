<!--
Face Detection Attendance App

This application:
- Detects a single face at a time using the webcam
- Increases a counter when a face is detected
- Allows resetting the counter to zero with a reset button
- Uses face-api.js with TinyFaceDetector model for efficient face detection

HOW TO USE:
1. Allow camera access when prompted
2. Position one person in front of the camera
3. Click "Scan" to detect the face and increase the counter
4. Click "Reset Total" to reset the counter to zero

NOTE: Models are loaded from an online CDN by default, but can be downloaded for offline use.
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Face Detection Attendance</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <script>
        // Register Service Worker for offline functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('Service Worker registered successfully:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
    <style>
        :root {
            --background: #0f172a;
            --card-bg: #1e293b;
            --card-border: #334155;
            --text: #f8fafc;
            --text-secondary: #ffffff;
            --primary: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow-x: hidden;
            position: fixed;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: var(--background);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        /* iOS Safari specific fixes */
        @supports (-webkit-touch-callout: none) {
            body {
                /* Prevent overscroll bounce effect */
                position: fixed;
                width: 100%;
                height: 100%;
            }
        }
        
        .container {
            width: 100%;
            height: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            gap: clamp(1rem, 2vw, 2rem);
            padding: clamp(1rem, 3vw, 2rem);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        header {
            text-align: center;
            margin-bottom: clamp(0.5rem, 2vw, 1rem);
            padding-top: env(safe-area-inset-top, 0);
            background: linear-gradient(to right, #2563eb, #7c3aed);
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            font-size: clamp(1.75rem, 5vw, 2.5rem);
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(to right, #ffffff, #f0f0ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .subtitle {
            color: var(--text-secondary);
            font-size: clamp(0.9rem, 3vw, 1.1rem);
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: clamp(1rem, 3vw, 2rem);
            flex: 1;
        }
        
        .video-container {
            position: relative;
            background: var(--card-bg);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--card-border);
            box-shadow: 0 0 30px rgba(79, 70, 229, 0.2);
            transition: box-shadow 0.3s ease;
        }
        
        #videoWrap {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 75%; /* 4:3 aspect ratio */
            overflow: hidden;
        }
        
        #video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
        }
        
        #fullscreenBtn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid var(--card-border);
            color: var(--text);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            z-index: 20;
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            transition: all 0.2s ease;
        }
        
        #fullscreenBtn:hover {
            background: rgba(30, 41, 59, 0.9);
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 1px var(--card-border), 0 0 30px rgba(79, 70, 229, 0.2);
            }
            50% {
                box-shadow: 0 0 0 1px var(--card-border), 0 0 30px rgba(79, 70, 229, 0.4);
            }
            100% {
                box-shadow: 0 0 0 1px var(--card-border), 0 0 30px rgba(79, 70, 229, 0.2);
            }
        }
        
        .controls-container {
            display: flex;
            flex-direction: column;
            gap: clamp(1rem, 3vw, 1.5rem);
        }
        
        .stats {
            background: var(--card-bg);
            border-radius: 16px;
            padding: clamp(1rem, 3vw, 1.5rem);
            border: 1px solid var(--card-border);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--card-border);
        }
        
        .stat:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: clamp(0.8rem, 2vw, 0.9rem);
        }
        
        .stat-value {
            font-size: clamp(1.2rem, 3vw, 1.5rem);
            font-weight: 600;
            color: var(--text);
            text-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
            transition: text-shadow 0.3s ease;
        }
        
        .controls {
            background: var(--card-bg);
            border-radius: 16px;
            padding: clamp(1rem, 3vw, 1.5rem);
            border: 1px solid var(--card-border);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: clamp(0.75rem, 2vw, 1rem);
        }
        
        button {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--card-border);
            color: var(--text);
            padding: clamp(0.6rem, 2vw, 0.75rem) clamp(0.75rem, 2vw, 1rem);
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: clamp(0.85rem, 2vw, 1rem);
        }
        
        button:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        #startBtn {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border: none;
            grid-column: span 2;
        }
        
        #startBtn:hover {
            box-shadow: 0 5px 15px rgba(79, 70, 229, 0.4);
        }
        
        .status-container {
            background: var(--card-bg);
            border-radius: 16px;
            padding: clamp(1rem, 3vw, 1.5rem);
            border: 1px solid var(--card-border);
        }
        
        #status {
            color: var(--text-secondary);
            transition: color 0.3s ease, opacity 0.3s ease;
            font-size: clamp(0.85rem, 2vw, 1rem);
        }
        
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .controls {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        @media (max-width: 600px) {
            .controls {
                grid-template-columns: 1fr;
            }
            
            #startBtn {
                grid-column: span 1;
            }
        }
        
        /* Landscape mode for small devices */
        @media (max-height: 500px) and (orientation: landscape) {
            .container {
                padding: 0.5rem;
                gap: 0.5rem;
            }
            
            header {
                margin-bottom: 0.25rem;
            }
            
            .main-content {
                grid-template-columns: 1fr 250px;
                gap: 0.5rem;
            }
            
            .controls-container {
                gap: 0.5rem;
            }
            
            .stats, .controls, .status-container {
                padding: 0.75rem;
            }
            
            .stat {
                padding-bottom: 0.5rem;
            }
        }
        
        /* Fullscreen styles */
        :fullscreen .video-container {
            border-radius: 0;
            border: none;
            box-shadow: none;
        }
        
        :fullscreen #videoWrap {
            padding-bottom: 0;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
          <h1>U M V BALBANGRA, MAHARAJGANJ</h1>
            <h1>Smart Attendance From Class 9 to 12</h1>
            <p class="subtitle">Scan faces to count attendance</p>
        </header>
        
        <div class="main-content">
            <div class="video-container">
                <div id="videoWrap">
                    <video id="video" autoplay muted playsinline></video>
                    <canvas id="overlay"></canvas>
                    <button id="fullscreenBtn" aria-label="Toggle fullscreen">â›¶</button>
                </div>
            </div>
            
            <div class="controls-container">
                <div class="stats">
                    <div class="stat">
                        <span class="stat-label">Total Count</span>
                        <span id="counter" class="stat-value">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Last Scan</span>
                        <span id="lastCount" class="stat-value">0</span>
                    </div>
                </div>
                
                <div class="controls">
                    <button id="startBtn">Scan</button>
                    <button id="resetBtn">Reset Total</button>
                    <button id="clearBtn">Clear Display</button>
                    <button id="autoBtn">Auto: Off</button>
                </div>
                
                <div class="status-container">
                    <p id="status">Loading...</p>
                </div>
            </div>
        </div>
    </div>
    
    <script src="face-api.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
